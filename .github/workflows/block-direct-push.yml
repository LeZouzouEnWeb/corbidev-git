name: ðŸš« Blocage des push directs sur branches protegees

on:
  push:
    branches:
      - develop
      - homol
      - main

# Pas de permissions spÃ©ciales nÃ©cessaires
permissions: {}

concurrency:
  group: block-direct-push-${{ github.ref }}
  cancel-in-progress: false

jobs:
  block_direct_push:
    runs-on: ubuntu-latest

    # âœ… Autoriser :
    #   - web-flow (GitHub quand tu merges une PR : merge / squash / rebase)
    #   - github-actions[bot] (si un workflow pousse du code)
    #   - dependabot[bot] (si tu utilises Dependabot)
    # âŒ Tout le reste est considÃ©rÃ© comme push direct interdit
    if: >
      !(
        github.actor == 'web-flow' ||
        github.actor == 'github-actions[bot]' ||
        github.actor == 'dependabot[bot]'
      )

    steps:
      - name: Block direct push
        run: |
          echo "### ContrÃ´le push direct" >> "$GITHUB_STEP_SUMMARY"
          echo "ðŸš« Push direct interdit sur \`${{ github.ref_name }}\`." >> "$GITHUB_STEP_SUMMARY"
          echo "ðŸ‘‰ Merci d'ouvrir une *Pull Request* depuis une branche \`feature/...\` vers \`${{ github.ref_name }}\`." >> "$GITHUB_STEP_SUMMARY"
          echo ""
          echo "ðŸ”Ž DÃ©tails :"
          echo "â€¢ Branch : ${{ github.ref_name }}"
          echo "â€¢ Pusher : ${{ github.actor }}"
          echo "â€¢ Commit  : ${{ github.sha }}"
          echo ""
          echo "ðŸš« Push direct interdit. Utilise une Pull Request."
          exit 1
